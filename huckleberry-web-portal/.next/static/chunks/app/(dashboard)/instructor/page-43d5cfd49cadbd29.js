(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[200],{1750:(e,t,r)=>{Promise.resolve().then(r.bind(r,8489))},8489:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>F});var a=r(5155),s=r(2115),n=r(5183),i=r(2821),l=r(5889);function o(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,l.QP)((0,i.$)(t))}var d=r(1719);let c=e=>{let{className:t,...r}=e;return(0,a.jsx)(n.bL,{"data-slot":"combobox",className:o(t),...r})};function u(e){let{className:t,...r}=e;return(0,a.jsx)(n.Mz,{"data-slot":"combobox-anchor",className:o("relative flex h-9 w-full items-center justify-between gap-2 rounded-md border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-900 px-3 py-2 shadow-xs focus-within:ring-2 focus-within:ring-indigo-500 dark:focus-within:ring-indigo-400 focus-within:border-indigo-500 dark:focus-within:border-indigo-400",t),...r})}function m(e){let{className:t,...r}=e;return(0,a.jsx)(n.pd,{"data-slot":"combobox-input",className:o("flex h-full w-full flex-1 bg-transparent text-base placeholder:text-muted-foreground focus:outline-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm border-0 ring-0",t),...r})}function h(e){let{className:t,children:r,...s}=e;return(0,a.jsx)(n.l9,{"data-slot":"combobox-trigger",className:o("flex shrink-0 items-center justify-center rounded-r-md border-input bg-transparent text-muted-foreground transition-colors hover:text-foreground/80 focus-visible:outline-hidden disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:r||(0,a.jsx)(d.D3D,{className:"size-4"})})}function g(e){let{className:t,...r}=e;return(0,a.jsx)(n.ZD,{"data-slot":"combobox-cancel",className:o("flex shrink-0 size-5 items-center justify-center rounded-sm text-gray-500 dark:text-neutral-400 opacity-70 ring-offset-background transition-opacity hover:opacity-100 hover:text-gray-700 dark:hover:text-neutral-200 focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 focus:ring-offset-2 disabled:pointer-events-none",t),...r,children:(0,a.jsx)(d.MKb,{className:"size-4"})})}function b(e){let{sideOffset:t=6,className:r,children:s,...i}=e;return(0,a.jsx)(n.ZL,{children:(0,a.jsx)(n.UC,{"data-slot":"combobox-content",sideOffset:t,className:o("data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-fit min-w-(--dice-anchor-width) origin-(--dice-transform-origin) overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=closed]:animate-out data-[state=open]:animate-in",r),...i,children:s})})}function x(e){let{className:t,...r}=e;return(0,a.jsx)(n.Sv,{"data-slot":"combobox-empty",className:o("py-6 text-center text-sm",t),...r})}function p(e){let{className:t,children:r,outset:s,...i}=e;return(0,a.jsxs)(n.q7,{"data-slot":"combobox-item",className:o("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 text-sm outline-hidden data-disabled:pointer-events-none data-highlighted:bg-accent data-highlighted:text-accent-foreground data-disabled:opacity-50",s?"pr-8 pl-2":"pr-2 pl-8",t),...i,children:[(0,a.jsx)(n.VF,{className:o("absolute flex size-3.5 items-center justify-center",s?"right-2":"left-2"),children:(0,a.jsx)(d.Srz,{className:"size-4"})}),(0,a.jsx)(n.p4,{children:r})]})}var f=r(231),v=r(9894),y=r(9089),k=r(3146),j=r(8773),w=r(7679),N=r(1962),S=r(3181),T=r(5350),A=r(8638),_=r(8127),C=r(3263),E=r(1190);function M(e){let{value:t,onChange:r,placeholder:n="Select date",className:i}=e,[l,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(t?new Date(t):new Date),m=(0,s.useRef)(null);(0,s.useEffect)(()=>{function e(e){m.current&&!m.current.contains(e.target)&&d(!1)}if(l)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]);let h=t?new Date(t):null,g=(0,f.w)(c),b=(0,v.p)(c),x=(0,y.k)(g),p=(0,k.$)(b),M=(0,j.k)({start:x,end:p});return(0,a.jsxs)("div",{ref:m,className:o("relative",i),children:[(0,a.jsxs)("button",{type:"button",onClick:()=>d(!l),className:o("w-full flex items-center justify-between gap-2 border border-gray-300 dark:border-neutral-700 rounded-md px-3 py-2 bg-white dark:bg-neutral-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 text-sm",!t&&"text-gray-500 dark:text-neutral-400"),children:[(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(_.A,{className:"w-4 h-4"}),t?(0,w.GP)(new Date(t),"MMM dd, yyyy"):n]}),(0,a.jsx)(C.A,{className:o("w-4 h-4 transition-transform",l&&"rotate-90")})]}),l&&(0,a.jsxs)("div",{className:"absolute z-50 mt-1 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-lg shadow-lg p-4 min-w-[280px]",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsx)("button",{type:"button",onClick:()=>u((0,S.a)(c,1)),className:"p-1 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded transition-colors",children:(0,a.jsx)(E.A,{className:"w-4 h-4"})}),(0,a.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:(0,w.GP)(c,"MMMM yyyy")}),(0,a.jsx)("button",{type:"button",onClick:()=>u((0,N.P)(c,1)),className:"p-1 hover:bg-gray-100 dark:hover:bg-neutral-800 rounded transition-colors",children:(0,a.jsx)(C.A,{className:"w-4 h-4"})})]}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-2",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,a.jsx)("div",{className:"text-center text-xs font-medium text-gray-500 dark:text-neutral-400 py-1",children:e},e))}),(0,a.jsx)("div",{className:"grid grid-cols-7 gap-1",children:M.map(e=>{let t=(0,T.t)(e,c),s=h&&(0,A.r)(e,h),n=(0,A.r)(e,new Date);return(0,a.jsx)("button",{type:"button",onClick:()=>{r((0,w.GP)(e,"yyyy-MM-dd")),d(!1)},disabled:!t,className:o("aspect-square flex items-center justify-center text-sm rounded transition-colors",!t&&"text-gray-300 dark:text-neutral-600",t&&"text-gray-900 dark:text-white hover:bg-gray-100 dark:hover:bg-neutral-800",n&&!s&&"bg-blue-50 dark:bg-blue-950/20 font-semibold",s&&"bg-indigo-600 dark:bg-indigo-500 text-white hover:bg-indigo-700 dark:hover:bg-indigo-600",!t&&"cursor-not-allowed"),children:(0,w.GP)(e,"d")},e.toISOString())})})]})]})}var D=r(2593);function I(e){let{value:t,onChange:r,placeholder:n="Select time",className:i}=e,[l,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(t?parseInt(t.split(":")[0]):12),[m,h]=(0,s.useState)(t?parseInt(t.split(":")[1]):0),[g,b]=(0,s.useState)(t?parseInt(t.split(":")[0])>=12?"PM":"AM":"PM"),x=(0,s.useRef)(null);(0,s.useEffect)(()=>{function e(e){x.current&&!x.current.contains(e.target)&&d(!1)}if(l)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]),(0,s.useEffect)(()=>{if(t){let[e,r]=t.split(":").map(Number);u(e>12?e-12:0===e?12:e),h(r),b(e>=12?"PM":"AM")}},[t]);let p=(e,t,a)=>{u(e),h(t),b(a),r("".concat(String("PM"===a?12===e?12:e+12:12===e?0:e).padStart(2,"0"),":").concat(String(t).padStart(2,"0")))},f=t?(()=>{let[e,r]=t.split(":").map(Number);return"".concat(String(e>12?e-12:0===e?12:e).padStart(2,"0"),":").concat(String(r).padStart(2,"0")," ").concat(e>=12?"PM":"AM")})():n,v=Array.from({length:12},(e,t)=>t+1),y=Array.from({length:60},(e,t)=>t),k=(0,s.useRef)({}),j=(0,s.useRef)({}),w=(0,s.useRef)({AM:null,PM:null});return(0,s.useEffect)(()=>{l&&setTimeout(()=>{var e,t,r;null==(e=k.current[c])||e.scrollIntoView({behavior:"smooth",block:"center"}),null==(t=j.current[m])||t.scrollIntoView({behavior:"smooth",block:"center"}),null==(r=w.current[g])||r.scrollIntoView({behavior:"smooth",block:"center"})},100)},[l,c,m,g]),(0,a.jsxs)("div",{ref:x,className:o("relative",i),children:[(0,a.jsx)("button",{type:"button",onClick:()=>d(!l),className:o("w-full flex items-center justify-between gap-2 border border-gray-300 dark:border-neutral-700 rounded-md px-3 py-2 bg-white dark:bg-neutral-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 text-sm",!t&&"text-gray-500 dark:text-neutral-400"),children:(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"w-4 h-4"}),f]})}),l&&(0,a.jsx)("div",{className:"absolute z-50 mt-1 bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-lg shadow-lg p-4 min-w-[240px]",children:(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-gray-500 dark:text-neutral-400 mb-2 text-center",children:"Hour"}),(0,a.jsx)("div",{className:"h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-neutral-700 scrollbar-track-transparent border-r border-gray-200 dark:border-neutral-700 pr-2",children:v.map(e=>(0,a.jsx)("button",{ref:t=>{k.current[e]=t},type:"button",onClick:()=>p(e,m,g),className:o("w-full py-2 text-center text-sm rounded transition-colors",c===e?"bg-gray-800 dark:bg-gray-700 text-white font-semibold border-2 border-gray-900 dark:border-gray-500":"text-gray-700 dark:text-neutral-300 hover:bg-gray-100 dark:hover:bg-neutral-800"),children:String(e).padStart(2,"0")},e))})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-gray-500 dark:text-neutral-400 mb-2 text-center",children:"Minute"}),(0,a.jsx)("div",{className:"h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-neutral-700 scrollbar-track-transparent border-r border-gray-200 dark:border-neutral-700 pr-2",children:y.map(e=>(0,a.jsx)("button",{ref:t=>{j.current[e]=t},type:"button",onClick:()=>p(c,e,g),className:o("w-full py-2 text-center text-sm rounded transition-colors",m===e?"bg-gray-200 dark:bg-gray-600 text-gray-900 dark:text-white font-semibold":"text-gray-700 dark:text-neutral-300 hover:bg-gray-100 dark:hover:bg-neutral-800"),children:String(e).padStart(2,"0")},e))})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"text-xs font-medium text-gray-500 dark:text-neutral-400 mb-2 text-center",children:"Period"}),(0,a.jsx)("div",{className:"h-48 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-300 dark:scrollbar-thumb-neutral-700 scrollbar-track-transparent",children:["AM","PM"].map(e=>(0,a.jsx)("button",{ref:t=>{w.current[e]=t},type:"button",onClick:()=>p(c,m,e),className:o("w-full py-2 text-center text-sm rounded transition-colors",g===e?"bg-gray-200 dark:bg-gray-600 text-gray-900 dark:text-white font-semibold":"text-gray-700 dark:text-neutral-300 hover:bg-gray-100 dark:hover:bg-neutral-800"),children:e},e))})]})]})})]})}let P=[{value:"America/New_York",label:"Eastern Time (ET)"},{value:"America/Chicago",label:"Central Time (CT)"},{value:"America/Denver",label:"Mountain Time (MT)"},{value:"America/Los_Angeles",label:"Pacific Time (PT)"},{value:"America/Phoenix",label:"Arizona (MST)"},{value:"America/Anchorage",label:"Alaska Time (AKT)"},{value:"America/Toronto",label:"Toronto (ET)"},{value:"America/Vancouver",label:"Vancouver (PT)"},{value:"America/Mexico_City",label:"Mexico City (CST)"},{value:"America/Sao_Paulo",label:"S\xe3o Paulo (BRT)"},{value:"America/Buenos_Aires",label:"Buenos Aires (ART)"},{value:"Europe/London",label:"London (GMT/BST)"},{value:"Europe/Paris",label:"Paris (CET/CEST)"},{value:"Europe/Berlin",label:"Berlin (CET/CEST)"},{value:"Europe/Rome",label:"Rome (CET/CEST)"},{value:"Europe/Madrid",label:"Madrid (CET/CEST)"},{value:"Europe/Amsterdam",label:"Amsterdam (CET/CEST)"},{value:"Europe/Stockholm",label:"Stockholm (CET/CEST)"},{value:"Europe/Moscow",label:"Moscow (MSK)"},{value:"Europe/Istanbul",label:"Istanbul (TRT)"},{value:"Asia/Dubai",label:"Dubai (GST)"},{value:"Asia/Kolkata",label:"Mumbai/New Delhi (IST)"},{value:"Asia/Bangkok",label:"Bangkok (ICT)"},{value:"Asia/Singapore",label:"Singapore (SGT)"},{value:"Asia/Hong_Kong",label:"Hong Kong (HKT)"},{value:"Asia/Shanghai",label:"Shanghai (CST)"},{value:"Asia/Tokyo",label:"Tokyo (JST)"},{value:"Asia/Seoul",label:"Seoul (KST)"},{value:"Asia/Sydney",label:"Sydney (AEDT/AEST)"},{value:"Asia/Melbourne",label:"Melbourne (AEDT/AEST)"},{value:"Pacific/Auckland",label:"Auckland (NZDT/NZST)"},{value:"Pacific/Honolulu",label:"Honolulu (HST)"}];function z(e){var t;let{value:r,onChange:n,className:i}=e,[l,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(r||"");(0,s.useEffect)(()=>{if(!r)try{let e=Intl.DateTimeFormat().resolvedOptions().timeZone;P.find(t=>t.value===e)?(u(e),n(e)):(u("America/New_York"),n("America/New_York"))}catch(e){u("America/New_York"),n("America/New_York")}},[]),(0,s.useEffect)(()=>{r&&u(r)},[r]);let m=(null==(t=P.find(e=>e.value===c))?void 0:t.label)||c;return(0,a.jsxs)("div",{className:o("relative",i),children:[(0,a.jsxs)("button",{type:"button",onClick:()=>d(!l),className:o("w-full flex items-center justify-between gap-2 border border-gray-300 dark:border-neutral-700 rounded-md px-3 py-2 bg-white dark:bg-neutral-900 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-indigo-500 dark:focus:ring-indigo-400 text-sm"),children:[(0,a.jsxs)("span",{className:"flex items-center gap-2",children:[(0,a.jsx)(D.A,{className:"w-4 h-4"}),m||"Select timezone"]}),(0,a.jsx)("svg",{className:o("w-4 h-4 transition-transform",l&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"fixed inset-0 z-40",onClick:()=>d(!1)}),(0,a.jsx)("div",{className:"absolute z-50 mt-1 w-full bg-white dark:bg-neutral-900 border border-gray-200 dark:border-neutral-800 rounded-lg shadow-lg max-h-64 overflow-y-auto",children:P.map(e=>(0,a.jsx)("button",{type:"button",onClick:()=>{u(e.value),n(e.value),d(!1)},className:o("w-full text-left px-3 py-2 text-sm hover:bg-gray-100 dark:hover:bg-neutral-800 transition-colors",c===e.value&&"bg-indigo-50 dark:bg-indigo-950/20 text-indigo-600 dark:text-indigo-400 font-medium"),children:e.label},e.value))})]})]})}var L=r(2251),O=r(6615),U=r(4640);function F(){var e,t;let[r,n]=(0,s.useState)([]),[i,l]=(0,s.useState)([]),[o,d]=(0,s.useState)(!1),[f,v]=(0,s.useState)(!0),[y,k]=(0,s.useState)(null),[j,w]=(0,s.useState)({}),[N,S]=(0,s.useState)(null),[T,A]=(0,s.useState)(""),[_,C]=(0,s.useState)("");async function E(e,t){let r=await fetch("/api/instructor/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"incdec",mentorshipId:e,delta:t})});if(r.ok){let t=await r.json();n(r=>r.map(r=>r.id===e?{...r,sessions_remaining:t.sessions_remaining}:r)),o&&l(r=>r.map(r=>({...r,mentorships:r.mentorships.map(r=>r.id===e?{...r,sessions_remaining:t.sessions_remaining}:r)})))}}async function M(e){var t;let r=j[e.id];if(!(null==r?void 0:r.date)||!(null==r?void 0:r.time))return;let a=T||Intl.DateTimeFormat().resolvedOptions().timeZone,s=function(e,t){let[r,a]=e.split("T"),[s,n,i]=r.split("-").map(Number),[l,o]=a.split(":").map(Number),d=new Date(Date.UTC(s,n-1,i,l,o)),c=new Intl.DateTimeFormat("en-US",{timeZone:t,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1});for(let e=0;e<5;e++){var u,m,h,g,b;let e=c.formatToParts(d),t=parseInt((null==(u=e.find(e=>"year"===e.type))?void 0:u.value)||"0"),r=parseInt((null==(m=e.find(e=>"month"===e.type))?void 0:m.value)||"0"),a=parseInt((null==(h=e.find(e=>"day"===e.type))?void 0:h.value)||"0"),x=parseInt((null==(g=e.find(e=>"hour"===e.type))?void 0:g.value)||"0"),p=parseInt((null==(b=e.find(e=>"minute"===e.type))?void 0:b.value)||"0");if(t===s&&r===n&&a===i&&x===l&&p===o)break;let f=new Date(Date.UTC(s,n-1,i,l,o)),v=new Date(Date.UTC(t,r-1,a,x,p)),y=f.getTime()-v.getTime();d=new Date(d.getTime()-y)}return d.toISOString()}("".concat(r.date,"T").concat(r.time),a),n=await fetch("/api/instructor/sessions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"schedule",mentorshipId:e.id,scheduledAtUtc:s,durationMinutes:60})});if(!n.ok)return;let i=await n.json(),l=new Date(new Date(s).getTime()-6e5).toISOString();await fetch("/api/notifications/enqueue",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({scheduled_session_id:i.scheduled_session_id,mentorship_id:e.id,mentee_discord_id:(null==(t=e.mentees)?void 0:t.discord_id)||"",instructor_discord_id:"",fire_at_utc:l})}),w(t=>{let r={...t};return delete r[e.id],r})}async function D(e){await E(e,-1)}function I(e,t){console.log("[Debug] Updating display name for mentorship:",e,"to:",t),n(r=>{let a=r.map(r=>r.id===e&&r.mentees?{...r,mentees:{...r.mentees,display_name:t}}:r);return console.log("[Debug] Updated mentorships state"),a}),o&&l(r=>{let a=r.map(r=>({...r,mentorships:r.mentorships.map(r=>r.id===e&&r.mentees?{...r,mentees:{...r.mentees,display_name:t}}:r)}));return console.log("[Debug] Updated instructors state"),a})}(0,s.useEffect)(()=>{let e=localStorage.getItem("instructor_timezone");e&&A(e)},[]),(0,s.useEffect)(()=>{(async()=>{try{let t=await fetch("/api/instructor/mentorships",{cache:"no-store"}),r=await t.json();if(!t.ok){k(r.error||"Failed to load mentorships (".concat(t.status,")")),v(!1);return}if(r.isAdmin){var e;d(!0),l(r.instructors||[]);let t=(r.instructors||[]).flatMap(e=>e.mentorships||[]);n(t),console.log("[Admin] Loaded instructors:",null==(e=r.instructors)?void 0:e.length,"Total mentorships:",t.length)}else d(!1),n(r.mentorships||[]);v(!1)}catch(e){k(e instanceof Error?e.message:"Failed to load mentorships"),v(!1)}})()},[]);let P=(0,s.useMemo)(()=>N?r.filter(e=>e.id===N):r,[r,N]),z=(0,s.useMemo)(()=>{if(o&&i.length>0){let e=i.flatMap(e=>e.mentorships||[]),t=new Map;return e.forEach(e=>{t.has(e.id)||t.set(e.id,e)}),Array.from(t.values())}return r||[]},[r,o,i]),L=(0,s.useMemo)(()=>{if(0===z.length)return[];let e=z.map(e=>{var t,r,a,s,n,i,l,o;let d;d=(null==(t=e.mentees)?void 0:t.display_name)?e.mentees.display_name:(null==(r=e.mentees)?void 0:r.discord_username)?e.mentees.discord_username.startsWith("@")?e.mentees.discord_username:"@".concat(e.mentees.discord_username):(null==(a=e.mentees)?void 0:a.discord_id)?e.mentees.discord_id:(null==(s=e.mentees)?void 0:s.email)?e.mentees.email.split("@")[0]||e.mentees.email:"Unknown Student";let c=[(null==(n=e.mentees)?void 0:n.display_name)||"",(null==(i=e.mentees)?void 0:i.discord_username)||"",(null==(l=e.mentees)?void 0:l.email)||"",(null==(o=e.mentees)?void 0:o.discord_id)||"",d].filter(Boolean).join(" ").toLowerCase();return{value:e.id,label:d,searchText:c}});if(_.trim()){let t=_.toLowerCase().trim();return e.filter(e=>e.searchText.includes(t))}return e},[z,_]);(0,s.useEffect)(()=>{console.log("[Debug] studentOptions updated:",L.length,"options"),L.length>0&&console.log("[Debug] First option:",L[0])},[L]);let O=(0,s.useMemo)(()=>o?{instructors:(i||[]).map(e=>({...e,mentorships:N?(e.mentorships||[]).filter(e=>e.id===N):e.mentorships||[]})).filter(e=>(e.mentorships||[]).length>0),mentorships:null}:{instructors:null,mentorships:P||[]},[o,i,N,P]);return f?(0,a.jsx)("p",{children:"Loading..."}):y?(0,a.jsxs)("div",{className:"p-4 rounded-md border bg-white dark:bg-neutral-950 dark:border-neutral-900",children:[(0,a.jsx)("div",{className:"font-medium text-red-600",children:"Error loading mentorships"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mt-1",children:y}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-neutral-400",children:"Make sure your account is an instructor and that Supabase envs are set."})]}):(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-xl font-semibold text-gray-900 dark:text-white",children:o?"Admin Dashboard":"Instructor Dashboard"}),z.length>0&&(0,a.jsxs)(c,{value:N||"",onValueChange:e=>{S(e||null),C("")},children:[(0,a.jsxs)(u,{children:[(0,a.jsx)(m,{placeholder:"Search students...",value:_,onChange:e=>{let t=e.target.value;C(t),N&&""!==t&&S(null)}}),N&&(0,a.jsx)(g,{onClick:()=>{S(null),C("")}}),(0,a.jsx)(h,{})]}),(0,a.jsxs)(b,{children:[(0,a.jsx)(x,{children:"No students found"}),L.map(e=>(0,a.jsx)(p,{value:e.value,children:e.label},e.value))]})]})]}),o&&O.instructors&&(0,a.jsxs)("div",{className:"space-y-6",children:[O.instructors.map(e=>{var t;return(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 pb-2 border-b border-gray-200 dark:border-neutral-800",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:e.instructor.name||"Instructor ".concat((null==(t=e.instructor.discord_id)?void 0:t.slice(-4))||"")||0}),(0,a.jsxs)("span",{className:"text-sm text-gray-600 dark:text-neutral-400",children:["(",e.mentorships.length," ",1===e.mentorships.length?"mentee":"mentees",")"]}),e.instructor.discord_id&&(0,a.jsxs)("span",{className:"text-xs text-gray-500 dark:text-neutral-500",children:["Discord ID: ",e.instructor.discord_id]})]}),(0,a.jsx)("div",{className:"grid gap-4 ml-4",children:e.mentorships.map(e=>(0,a.jsx)(B,{m:e,schedule:j,setSchedule:w,adjustSessions:E,scheduleSession:M,logSession:D,isAdmin:!0,instructorTimezone:T,setInstructorTimezone:A,onDisplayNameUpdate:I},e.id))})]},e.instructor.id)}),0===O.instructors.length&&(0,a.jsxs)("div",{className:"p-4 rounded-md border border-gray-200 dark:border-neutral-900 bg-white dark:bg-neutral-950",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:"No instructors with active mentees"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mt-1",children:N?"No instructors found for the selected student. Selected: ".concat(N):"No active mentorships found."})]})]}),!o&&(0,a.jsxs)("div",{className:"grid gap-4",children:[null==(e=O.mentorships)?void 0:e.map(e=>(0,a.jsx)(B,{m:e,schedule:j,setSchedule:w,adjustSessions:E,scheduleSession:M,logSession:D,isAdmin:!1,instructorTimezone:T,setInstructorTimezone:A,onDisplayNameUpdate:I},e.id)),(null==(t=O.mentorships)?void 0:t.length)===0&&r.length>0&&(0,a.jsxs)("div",{className:"p-4 rounded-md border border-gray-200 dark:border-neutral-900 bg-white dark:bg-neutral-950",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:"No students match your filter"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mt-1",children:"Try selecting a different student or clearing the filter."})]}),0===r.length&&(0,a.jsxs)("div",{className:"p-4 rounded-md border border-gray-200 dark:border-neutral-900 bg-white dark:bg-neutral-950",children:[(0,a.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:"No active mentees"}),(0,a.jsx)("p",{className:"text-sm text-gray-600 dark:text-neutral-400 mt-1",children:"When students are linked to you, they will show here with remaining sessions."})]})]})]})}function B(e){var t,r,n,i,l,d,c,u,m,h,g,b;let x,{m:p,schedule:f,setSchedule:v,adjustSessions:y,scheduleSession:k,logSession:j,isAdmin:w,instructorTimezone:N,setInstructorTimezone:S,onDisplayNameUpdate:T}=e;x=(null==(t=p.mentees)?void 0:t.display_name)?p.mentees.display_name:(null==(r=p.mentees)?void 0:r.discord_username)?p.mentees.discord_username.startsWith("@")?p.mentees.discord_username:"@".concat(p.mentees.discord_username):(null==(n=p.mentees)?void 0:n.discord_id)?p.mentees.discord_id:(null==(i=p.mentees)?void 0:i.email)?p.mentees.email.split("@")[0]||p.mentees.email:"Unknown Student";let A=null!=(b=p.sessions_remaining)?b:0,[_,C]=(0,s.useState)(!1),[E,D]=(0,s.useState)((null==(l=p.mentees)?void 0:l.display_name)||""),[P,F]=(0,s.useState)(!1);async function B(){var e;if(null==(e=p.mentees)?void 0:e.id){F(!0);try{let e=await fetch("/api/instructor/mentees/display-name",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({menteeId:p.mentees.id,displayName:E.trim()||null})});if(e.ok){let t=await e.json();p.mentees&&(p.mentees.display_name=t.display_name),C(!1),T&&T(p.id,t.display_name)}}catch(e){console.error("Failed to save display name:",e)}finally{F(!1)}}}function R(){var e;D((null==(e=p.mentees)?void 0:e.display_name)||""),C(!1)}return(0,a.jsxs)("div",{className:"p-6 border border-gray-200 dark:border-neutral-900 rounded-lg bg-white dark:bg-neutral-950 shadow-sm",children:[(0,a.jsx)("div",{className:"flex items-start justify-between mb-6",children:(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsxs)("div",{className:"text-center mb-4",children:[_?(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,a.jsx)("input",{type:"text",value:E,onChange:e=>D(e.target.value),onKeyDown:e=>{"Enter"===e.key?B():"Escape"===e.key&&R()},className:"text-3xl font-bold text-center bg-transparent border-b-2 border-indigo-500 dark:border-indigo-400 text-gray-900 dark:text-white focus:outline-none focus:border-indigo-600 dark:focus:border-indigo-500 max-w-md",placeholder:"Enter display name...",autoFocus:!0,maxLength:100}),(0,a.jsx)("button",{onClick:B,disabled:P,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-neutral-800 text-green-600 dark:text-green-400 disabled:opacity-50",title:"Save",children:(0,a.jsx)(L.A,{size:20})}),(0,a.jsx)("button",{onClick:R,disabled:P,className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-neutral-800 text-red-600 dark:text-red-400 disabled:opacity-50",title:"Cancel",children:(0,a.jsx)(O.A,{size:20})})]}):(0,a.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-2",children:[(0,a.jsx)("div",{className:"text-3xl font-bold text-gray-900 dark:text-white",children:x}),(0,a.jsx)("button",{onClick:()=>C(!0),className:"p-1 rounded hover:bg-gray-100 dark:hover:bg-neutral-800 text-gray-500 dark:text-neutral-400 hover:text-gray-700 dark:hover:text-neutral-200",title:"Edit display name",children:(0,a.jsx)(U.A,{size:18})})]}),w&&(0,a.jsxs)("div",{className:"text-sm text-gray-600 dark:text-neutral-400",children:[(null==(d=p.mentees)?void 0:d.discord_id)?"Discord ID: ".concat(p.mentees.discord_id):"No Discord ID",(null==(c=p.mentees)?void 0:c.email)&&" • ".concat(p.mentees.email)]})]}),(0,a.jsx)("div",{className:"text-center mb-6",children:(0,a.jsxs)("div",{className:o("text-2xl font-bold",0===A?"text-red-600 dark:text-red-400":"text-gray-900 dark:text-white"),children:[A," ",1===A?"mentorship session":"mentorship sessions"," remaining"]})})]})}),(0,a.jsx)("div",{className:"mb-4",children:(0,a.jsxs)("button",{onClick:()=>j(p.id),disabled:0===A,className:"w-full px-4 py-3 rounded-md bg-indigo-600 dark:bg-indigo-500 text-white font-medium hover:bg-indigo-700 dark:hover:bg-indigo-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-indigo-600 dark:disabled:hover:bg-indigo-500",children:["Log a mentorship session with ",x]})}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("button",{onClick:()=>y(p.id,1),className:"w-full px-4 py-2 rounded-md border border-gray-300 dark:border-neutral-700 bg-white dark:bg-neutral-900 text-gray-700 dark:text-neutral-300 hover:bg-gray-50 dark:hover:bg-neutral-800 transition-colors font-medium",children:"Add sessions"}),(0,a.jsx)("p",{className:"text-sm font-medium text-amber-600 dark:text-amber-400 mt-2 text-center",children:"⚠️ Only add mentorship sessions if you logged sessions by mistake"})]}),(0,a.jsxs)("div",{className:"pt-4 border-t border-gray-200 dark:border-neutral-800",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-700 dark:text-neutral-300 mb-3",children:"Schedule future session"}),!w&&(0,a.jsxs)("div",{className:"mb-3",children:[(0,a.jsx)("label",{className:"block text-xs text-gray-600 dark:text-neutral-400 mb-1",children:"Your timezone"}),(0,a.jsx)(z,{value:N,onChange:e=>{S(e),localStorage.setItem("instructor_timezone",e)}})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-3 mb-3",children:[(0,a.jsx)(M,{value:null==(u=f[p.id])?void 0:u.date,onChange:e=>{v(t=>{let r=t[p.id]||{time:""};return{...t,[p.id]:{...r,date:e}}})},placeholder:"Select date"}),(0,a.jsx)(I,{value:null==(m=f[p.id])?void 0:m.time,onChange:e=>{v(t=>{let r=t[p.id]||{date:""};return{...t,[p.id]:{...r,time:e}}})},placeholder:"Select time"})]}),(0,a.jsx)("button",{onClick:()=>k(p),disabled:!(null==(h=f[p.id])?void 0:h.date)||!(null==(g=f[p.id])?void 0:g.time)||!w&&!N,className:"w-full px-4 py-2 rounded-md bg-gray-600 dark:bg-gray-500 text-white hover:bg-gray-700 dark:hover:bg-gray-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:"Schedule & Notify (60 min)"}),!w&&!N&&(0,a.jsx)("p",{className:"text-xs text-amber-600 dark:text-amber-400 mt-1 text-center",children:"Please select your timezone above"})]})]},p.id)}}},e=>{e.O(0,[545,105,915,884,441,255,358],()=>e(e.s=1750)),_N_E=e.O()}]);